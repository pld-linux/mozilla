diff -Nrc -x *~ mozilla.orig/xpfe/bootstrap/mozilla mozilla/xpfe/bootstrap/mozilla
--- mozilla.orig/xpfe/bootstrap/mozilla	Tue Jan 23 15:34:56 2001
+++ mozilla/xpfe/bootstrap/mozilla	Sat Apr 21 01:21:26 2001
@@ -1,70 +1,154 @@
 #!/bin/sh
 #
-# The contents of this file are subject to the Netscape Public License
-# Version 1.0 (the "NPL"); you may not use this file except in
-# compliance with the NPL.  You may obtain a copy of the NPL at
-# http://www.mozilla.org/NPL/
+# The contents of this file are subject to the Netscape Public
+# License Version 1.1 (the "License"); you may not use this file
+# except in compliance with the License. You may obtain a copy of
+# the License at http://www.mozilla.org/NPL/
 #
-# Software distributed under the NPL is distributed on an "AS IS" basis,
-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the NPL
-# for the specific language governing rights and limitations under the
-# NPL.
+# Software distributed under the License is distributed on an "AS
+# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
+# implied. See the License for the specific language governing
+# rights and limitations under the License.
 #
-# The Initial Developer of this code under the NPL is Netscape
+# The Original Code is mozilla.org code.
+#
+# The Initial Developer of the Original Code is Netscape
 # Communications Corporation.  Portions created by Netscape are
-# Copyright (C) 1998 Netscape Communications Corporation.  All Rights
-# Reserved.
+# Copyright (C) 1998 Netscape Communications Corporation. All
+# Rights Reserved.
 #
+# Contributor(s): 
+# Chris Blizzard
+# Frank Belew
+# Christopher Seawood
+
 
-## $Id$
 ## 
 ## Usage:
 ##
-## $ mozilla [args]
+## $ mozilla
 ##
-## This script is meant to run the mozilla-bin binary from either 
-## mozilla/xpfe/bootstrap or mozilla/dist/bin.
+## This script is meant to run a mozilla program from the mozilla
+## rpm installation.
 ##
 ## The script will setup all the environment voodoo needed to make
-## the mozilla-bin binary to work.
+## mozilla work.
+
+##
+## Standard shell script disclaimer blurb thing:
+##
+## This script is a hcak.  Its brute force.  Its horrible.  
+## It doesnt use Artificial Intelligence.  It doesnt use Virtual Reality.
+## Its not perl.  Its not python.  It probably wont work unchanged on
+## the "other" thousands of unices.  But it worksforme.
+##
+## If you have an improvement, patch, idea, whatever, on how to make this
+## script better, post it here:
+##
+## news://news.mozilla.org/netscape.public.mozilla.patches
+## news://news.mozilla.org/netscape.public.mozilla.unix
+##
+## 
+
+##
+## Potential improvements:
+##
+## + Run ldd on the program and report missing dlls
+## + All the "other" unices/packages
+##
+MOZ_PROGRAM=`type -p mozilla-bin`
+if [ -z ${MOZ_PROGRAM} ]; then
+	echo 'mozilla-bin not found in path!'
+fi
+
 ##
+## Variables
+##
+MOZ_PREFIX=`dirname ${MOZ_PROGRAM} | sed 's,bin$,,'`
+
+##
+## Set MOZILLA_FIVE_HOME
+##
+MOZILLA_FIVE_HOME="${MOZ_PREFIX}/lib/mozilla-0.8.1"
+
+export MOZILLA_FIVE_HOME
+
+# Test for RPM's broken postuninstall
+if [ ! -d ${MOZILLA_FIVE_HOME} ]; then
+	BROKEN=1
+elif [ ! -f ${MOZILLA_FIVE_HOME}/component.reg ]; then
+	BROKEN=1
+else
+	NUMFILES=`ls -1 ${MOZILLA_FIVE_HOME} | wc -l`
+	if [ ${NUMFILES} -lt 8 ]; then
+		BROKEN=1
+	fi
+fi
+if [ -n "${BROKEN}" ]; then
+	echo "Mozilla has not been installed correctly."
+	echo
+	echo "Please either reinstall the application or contact your"
+	echo "system administrator for assistance."
+	exit 1
+fi
+
+# If there is no command line argument at all then try to open a new
+# window in an already running instance.
+
+if [ -z "$1" ]; then
+  $MOZ_PROGRAM -remote "openurl(about:blank,new-window)" 2>/dev/null >/dev/null
+  # no window found?
+  RETURN_VAL=$?
+  if [ "$RETURN_VAL" -ne "0" ]; then
+    exec $MOZ_PROGRAM ${1+"$@"}
+  fi
+
+  if [ "$RETURN_VAL" -eq "0" ]; then
+    exit 0;
+  fi
+  echo "Error sending command."
+  exit $RETURN_VAL
+fi
 
-#uncomment for debugging
-#set -x
+unset RETURN_VAL
 
-dist_bin=`dirname $0`
-script_args=""
-moreargs=""
-debugging=0
-MOZILLA_BIN="mozilla-bin"
+# If there's a command line argument but it doesn't begin with a -
+# it's probably a url.  Try to send it to a running instance.
 
-if [ "$OSTYPE" = "beos" ]; then
-  mimeset -F $MOZILLA_BIN
+USE_EXIST=0
+opt="$1"
+case "$opt" in
+  -*) ;;
+  *) USE_EXIST=1 ;;
+esac
+
+if [ "$USE_EXIST" -eq "1" ]; then
+  # check to make sure that the command contains at least a :/ in it.
+  echo $opt | grep -e ':/' 2>/dev/null > /dev/null
+  RETURN_VAL=$?
+  if [ "$RETURN_VAL" -eq "1" ]; then
+    # does it begin with a / ?
+    echo $opt | grep -e '^/' 2>/dev/null > /dev/null
+    RETURN_VAL=$?
+    if [ "$RETURN_VAL" -eq "0" ]; then
+      opt="file:$opt"
+    elif [ -e `pwd`/$opt ]; then
+      opt="file://`pwd`/$opt"
+    else
+      opt="http://$opt"
+    fi
+  fi
+  # ok, send it
+  $MOZ_PROGRAM -remote "openurl($opt)" 2>/dev/null > /dev/null
+  RETURN_VAL=$?
+  if [ "$RETURN_VAL" -eq "2" ]; then
+    exec $MOZ_PROGRAM ${1+"$@"}
+  fi
+  if [ "$RETURN_VAL" -eq "0" ]; then
+    exit 0;
+  fi
+  echo "Error sending command."
+  exit $RETURN_VAL
 fi
 
-while [ $# -gt 0 ]
-do
-  case "$1" in
-    -p | -pure)
-      MOZILLA_BIN="mozilla-bin.pure"
-      shift
-      ;;
-    -g | --debug)
-      script_args="$script_args -g"
-      debugging=1
-      shift
-      ;;
-    -d | --debugger)
-      script_args="$script_args -d $2"
-      shift 2
-      ;;
-    *)
-      moreargs="$moreargs \"$1\""
-      shift 1
-      ;;
-  esac
-done
-
-eval "set -- $moreargs"
-echo $dist_bin/run-mozilla.sh $script_args $dist_bin/$MOZILLA_BIN "$@"
-exec $dist_bin/run-mozilla.sh $script_args $dist_bin/$MOZILLA_BIN "$@"
+exec $MOZ_PROGRAM ${1+"$@"}
